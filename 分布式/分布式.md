`介绍和分布式架构`   
重要的`进程`   
`进程间通信`，通信打破独立运行涉及`同步`协作和相互`资源的访问`  
!`复制副本`（可靠性可扩展性和性能（服务器负载，地理位置，访问的便捷）导致`一致性`问题（更新的传播，副本同样的修改更新  
!`容错`（容忍错误发生故障仍能运行，从故障中恢复）（出现问题！！！）


进程的通信->进程的同步协作：同步事件顺序，互斥访问

时钟同步（一致性算法）
互斥访问
选举算法（进程组，协作者）



## 复制的原因和结果
## 一致性模型及一致性协议（实现）
以数据为中心的一致性模型，以客户为中心的一致性模型（简单的可实现的
放松一致性要求：一致性模型(要这样/建模，不一定有解）
严格一致性：任何读操作都能读取到最新的修改，换句话说，要求任何写操作都立刻同步到其他所有进程。这里强调的是绝对时钟上的立刻同步，而任何信息的同步都需要延迟，因此在分布式系统下无法严格实现。
持续一致性：数值偏差，新旧偏差，顺序偏差
线性一致性，所有节点上事件发生的的顺序全部一样，且和全局时间上时间发生的顺序一致
顺序一致性，所有节点上事件发生的的顺序全部一样，但是可能和全局时间上发生的顺序不一致
相比顺序一致性，因果一致性去掉了那些没有联系的操作需达成一致顺序观点的要求，只保留了那些必要的顺序
FIFO一致性：要求同一个进程的更新操作被其他所有进程看到的顺序是相同的。但是不同进程的几个操作被其他所有进程看到的顺序可能是不同的
入口一致性：把数据和同步化变量关联
（理解，副本数据/绝对时间线，什么东西是必须保证顺序的，读是写顺序的反应！！！！）

最终一致性：如果很长时间没有更新操作，所有副本逐渐一致，（只要求更新能传播到所有副本上）
以客户为中心的一致性模型：只为单一用户提供访问的一致性，不保证不同用户并发访问的一致性
问题：单一副本操作√，不同副本操作×

要什么样
单调读模型：不会读到更早的版本
单调写：副本数据项的写操作顺序一样
读写一致性：副本数据项的写更新都能被后续读看见
写读一致性：基于最新读到的值写

一致性协议(一致性模型的实现)

## 复制（副本）的管理：
1.副本放置 
2.副本一致性（更新的传播）
实际传播的信息内容，更新基于推/拉（比较表格）


一个协作者，单点失效
顺序一致性：主备份协议（每个数据项有一个主备份副本，更新操作在主副本上进行再传播：远程写协议，本地写协议，结合）
复制的写协议（更新操作在多个副本上进行）：主动复制（更新传播到所有副本，保证操作的顺序：全序的多播机制：lampart时间戳，定序器），基于多数表决的协议（读写操作需要请求多个服务器得到许可（读团体/写团体的原子性：2-读写冲突/写写冲突（only无读读））多种变形：半数+1，ROWA）




可靠性系统特征,故障类型
发生错误-处理故障：冗余（信息：加信息/时间：重发/物理：三倍模块冗余，复制多备份几个投票）
分布式系统：进程故障，通信故障（有多种故障，主要的是崩溃性故障和遗漏性故障）
### 进程故障
进程容错：复制进程（目的：一个进程失败，其他进程代替接管/方法：）组织成组（目的：组的概率把进程集合形成单一概念。方法：）
进程组的复制-组织方式：
（复制：主备份协议）：等级组（单点失败问题）
（复制：复制的写协议）平等组（分布式协调的代价）---->（`可靠多播`）

`可靠多播`：消息可靠的发送给多个接收者（进程组里所有进程）
基本方法：（数目较少时）多个可靠点对点通信：发送方反馈拥塞--只反馈否认：不确保避免拥塞+长久缓存--无等级反馈控制（随机等待，反馈抑制--后续：独立编组共享反馈消息重发通道/本地恢复其他接收方分享消息）----分等级的反馈控制（组织成树，子组协作者+用小的可靠多播）
可扩展可靠多播，接收方规模
更严格的
`原子多播`：no or all，相同顺序
虚拟同步多播：消息崩溃前发出，要么全接收要么忽略，所有多播都在视图(|组状态)改变之间进行，不能跨越视图
更一般的问题（通用性！！）
`分布式提交`：no or all，相同顺序
单阶段提交协议：设立协作者，无法处理其他节点失败
两阶段提交协议（阻塞提交协议）：正常情况-4(2×2)/状态机  异常情况的阻塞处理，但不能处理所有参与者ready等待最终协议时协作者崩溃的情况，在协作者恢复前参与者持续阻塞
三阶段提交协议：协作者和参与者状态满足两个条件--！所以进入precommit状态相当于commit了，所有必同意（没有init）/已经形成了最终决策/一定是要提交的、（除非阻塞）



`K容错`：一次性最多容忍K个错误
沉默失败：K+1
拜占庭失败（故障继续运行）：至少2K+1（K+K+1）~3K+1画图题/多数决策！
拜占庭问题：尔虞我诈欺骗对应发生故障错误

`故障检测`：1节点主动探测其他节点(ping ping不通看其他) 2.定期告知邻节点(可用信息很旧说明故障)

### 通信故障
RPC
正常：隐层通信，使远程调用好像本地调用
出现问题：5种(1+2+2/流程顺序)
1.无法定位：\
2.请求消息丢失：定时器重发即可
3.服务器崩溃：！
3.应答丢失：无法判断到底情况没收到，幂等性？：简单重发+序列号
5.客户端崩溃：孤儿进程


## 可靠多播
## 分布式提交

## 系统恢复
1.回退恢复：设置检查点
2.前向恢复：必须预知可能发生的错误
代价--结果
性能和效果

检查点
独立检查点：简单效果不好：恢复性计算困难，不能组成分布式快照多米诺效应
协调检查点：效果好性能问题（1分布式快照 2.简单：2PC）
少的检查点配合消息日志：记录系统操作，发生错误时从检查点状态开始，重现系统操作

共性问题和解决方案：
中间件
进程 机器 节点
操作银行和打印的例子幂等非幂等

任何问题：故障处理：3冗余
任何协同操作：分布式提交（123PC的本质）

重发序列号
中心协作者和分布式处理
单点失败问题vs分布式协调的代价
复杂性，代价，代价守恒，好的算法代价转换后的部分小


消息 网络 本地操作系统 中间缓存接收 应用程序/进程

任意缓慢的进程和崩溃的进程,网络故障还是节点故障
本质问题，思想迁移
